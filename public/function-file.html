<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OLXCatAI Function File</title>

    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
</head>

<body>
    <div id="content-main">
        <div class="padding">
            <p>OLXCatAI Function File</p>
            <p>This file provides Office.js integration for the OLXCatAI Add-In.</p>
        </div>
    </div>

    <script type="text/javascript">
        // Initialize Office.js
        Office.onReady(function() {
            console.log('Office.js is ready');
        });

        // Global function to get current email data
        function getCurrentEmailData() {
            return new Promise((resolve, reject) => {
                try {
                    var item = Office && Office.context && Office.context.mailbox && Office.context.mailbox.item;
                    if (!item) {
                        reject(new Error('Mailbox item not available'));
                        return;
                    }

                    // Resolve subject for read or compose
                    var resolveSubject = function(cb) {
                        if (typeof item.subject === 'string') { cb(item.subject); return; }
                        if (item.subject && item.subject.getAsync) {
                            item.subject.getAsync(function(res) {
                                cb(res && res.status === Office.AsyncResultStatus.Succeeded ? res.value : '');
                            });
                            return;
                        }
                        cb('');
                    };

                    // Resolve sender (available in read mode)
                    var resolveSender = function() {
                        try {
                            return item.from && item.from.emailAddress ? item.from.emailAddress : '';
                        } catch (e) { return ''; }
                    };

                    // Resolve body text (works in both modes via body.getAsync)
                    var resolveBody = function(cb) {
                        if (item.body && item.body.getAsync) {
                            item.body.getAsync(Office && Office.CoercionType ? Office.CoercionType.Text : 'text', function(res) {
                                cb(res && res.status === Office.AsyncResultStatus.Succeeded ? res.value : '');
                            });
                        } else {
                            cb('');
                        }
                    };

                    resolveSubject(function(subject) {
                        resolveBody(function(bodyText) {
                            var emailData = {
                                subject: subject,
                                sender: resolveSender(),
                                body: bodyText,
                                receivedDate: item.dateTimeCreated || null,
                                id: item.itemId || null
                            };
                            resolve(emailData);
                        });
                    });
                } catch (err) {
                    reject(err);
                }
            });
        }

        // Global function to categorize email
        function categorizeEmail(categoryName) {
            return new Promise((resolve) => {
                console.log('Categorizing email as:', categoryName);
                resolve({ success: true, category: categoryName });
            });
        }

        // Global function to get user's email folders
        function getUserFolders() {
            return new Promise((resolve, reject) => {
                // This is a placeholder - actual implementation will use Microsoft Graph API
                const mockFolders = [
                    { name: 'Inbox', id: 'inbox' },
                    { name: 'Sent Items', id: 'sent' },
                    { name: 'Drafts', id: 'drafts' },
                    { name: 'Deleted Items', id: 'deleted' }
                ];
                resolve(mockFolders);
            });
        }

        // Global function to create a new folder
        function createFolder(folderName) {
            return new Promise((resolve, reject) => {
                // This is a placeholder - actual implementation will use Microsoft Graph API
                console.log(`Creating folder: ${folderName}`);
                resolve({ success: true, folderName: folderName });
            });
        }

        // Global function to move email to folder
        function moveEmailToFolder(folderId) {
            return new Promise((resolve, reject) => {
                // This is a placeholder - actual implementation will use Microsoft Graph API
                console.log(`Moving email to folder: ${folderId}`);
                resolve({ success: true, folderId: folderId });
            });
        }

        // Global function to get user profile
        function getUserProfile() {
            return new Promise((resolve, reject) => {
                // This is a placeholder - actual implementation will use Microsoft Graph API
                const mockProfile = {
                    displayName: 'John Doe',
                    email: 'john.doe@company.com',
                    id: 'user123'
                };
                resolve(mockProfile);
            });
        }

        // Make functions available globally
        window.OLXCatAI = {
            getCurrentEmailData,
            categorizeEmail,
            getUserFolders,
            createFolder,
            moveEmailToFolder,
            getUserProfile
        };
    </script>
</body>
</html> 